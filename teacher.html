<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>학부모 대시보드 - 학생 모니터링</title>
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0"
    rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#E30000",
            "background-light": "#FAFAFA",
            "background-dark": "#111827",
            "surface-light": "#FFFFFF",
            "surface-dark": "#1F2937",
            "border-light": "#E5E7EB",
            "border-dark": "#374151",
          },
          fontFamily: {
            display: ["'Outfit'", "'Pretendard'", "sans-serif"],
            body: ["'Pretendard'", "'Outfit'", "sans-serif"],
          },
          borderRadius: {
            DEFAULT: "0.5rem",
            "xl": "1rem",
            "2xl": "1.5rem",
          },
          boxShadow: {
            'soft': '0 1px 3px 0 rgba(0, 0, 0, 0.05), 0 1px 2px -1px rgba(0, 0, 0, 0.05)',
            'card': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.025)',
          },
          animation: {
            "fade-in": "fadeIn 0.5s ease-out forwards",
          }
        },
      },
    };
  </script>
  <style>
    body {
      font-family: 'Pretendard', sans-serif;
    }

    .glass-panel {
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .glass-header {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
  </style>
</head>

<body
  class="bg-[#FAFAFA] text-slate-800 min-h-screen transition-colors duration-300 font-body antialiased selection:bg-red-500/20 selection:text-red-700 relative overflow-x-hidden">

  <!-- Header -->
  <header class="glass-header sticky top-0 z-50 transition-all duration-300">
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
      <div class="flex justify-between h-14 items-center">
        <div class="flex items-center gap-4">
          <a href="./index.html" class="p-1.5 rounded-full hover:bg-black/5 transition-colors text-gray-500">
            <span class="material-symbols-rounded text-xl">arrow_back</span>
          </a>
          <div class="flex items-center gap-1">
            <img src="img/logo.png" alt="순공시간" class="h-6">
            <span class="ml-2 px-2 py-0.5 rounded-full bg-slate-100 text-[10px] font-bold text-slate-500">TEACHER</span>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <div id="connection-badge"
            class="hidden items-center px-2 py-1 rounded-full bg-slate-100 border border-slate-200">
            <span class="relative flex h-2 w-2 mr-1.5">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
              <span class="relative inline-flex rounded-full h-2 w-2 bg-red-500"></span>
            </span>
            <span class="text-xs font-bold text-slate-600">LIVE</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 py-3 space-y-3">

    <!-- Setup Section -->
    <section id="setup-section" class="flex justify-center pt-8">
      <div class="w-full max-w-md bg-white rounded-2xl shadow-sm border border-slate-200 p-8 text-center">
        <div id="setup-content">
          <h2 class="text-2xl font-display font-bold text-slate-900 mb-8 tracking-tight">모니터링 시작</h2>

          <!-- 저장된 ID 히스토리 -->
          <div id="saved-id-box" class="hidden mb-6 p-4 bg-slate-50 border border-slate-200 rounded-xl">
            <div class="flex items-center justify-between mb-2">
              <div class="flex items-center gap-2 text-slate-600">
                <span class="material-symbols-rounded text-sm">history</span>
                <span class="text-xs font-bold">최근 사용한 서버 ID</span>
              </div>
              <button id="clear-id-history-btn"
                class="text-[10px] text-slate-400 hover:text-slate-600 transition-colors">전체
                삭제</button>
            </div>
            <div id="saved-id-list" class="space-y-1.5 max-h-32 overflow-y-auto"></div>
          </div>

          <div class="mb-4">
            <label class="flex items-center gap-2 text-sm text-slate-600 mb-2 font-medium">
              <input type="checkbox" id="use-custom-id"
                class="rounded border-slate-300 text-primary focus:ring-primary">
              <span>고정 ID 사용</span>
            </label>
            <input type="text" id="custom-id-input"
              class="hidden w-full px-4 py-3 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 text-sm focus:ring-2 focus:ring-primary focus:border-primary transition-all"
              placeholder="ID 입력">
          </div>

          <button id="start-server-btn"
            class="w-full py-3.5 px-4 bg-slate-900 hover:bg-slate-800 text-white font-bold rounded-xl transition-all shadow-lg active:scale-[0.98] flex items-center justify-center gap-2 text-sm">
            <span class="material-symbols-rounded text-lg">rocket_launch</span>
            서버 시작
          </button>
        </div>

        <!-- Teacher ID Box -->
        <div id="teacher-id-box" class="hidden">
          <!-- Teacher ID Box -->
          <div id="teacher-id-box" class="hidden">
            <div class="flex gap-2 items-center justify-center">
              <div class="relative flex-1">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <span class="material-symbols-rounded text-slate-400 text-lg">link</span>
                </div>
                <input id="teacher-id-display"
                  class="block w-full pl-10 pr-3 py-3 rounded-xl border border-slate-200 text-center font-mono font-bold text-sm text-slate-900 bg-slate-50 focus:ring-0 focus:border-slate-300 transition-colors cursor-pointer hover:bg-slate-100"
                  readonly type="text" value="-" />
              </div>
              <button id="copy-id-btn"
                class="p-3 bg-slate-900 hover:bg-slate-800 text-white rounded-xl shadow-md transition-all active:scale-95 flex items-center justify-center">
                <span class="material-symbols-rounded text-lg">content_copy</span>
              </button>
            </div>
          </div>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section id="dashboard-section" class="hidden space-y-6 max-w-7xl mx-auto pb-20 pt-6">

      <!-- 1. Status Summary Cards -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- Standing -->
        <div
          class="bg-white rounded-2xl border border-slate-200 p-5 shadow-sm flex flex-col justify-between h-24 relative overflow-hidden group">
          <div class="flex items-center gap-2 z-10">
            <div class="w-8 h-8 rounded-lg bg-emerald-50 text-emerald-600 flex items-center justify-center">
              <span class="material-symbols-rounded">accessibility_new</span>
            </div>
            <span class="font-bold text-slate-500 text-sm">서있음</span>
          </div>
          <span id="count-standing" class="text-3xl font-black text-emerald-600 z-10 ml-1">0</span>
          <!-- Decoration -->
          <div
            class="absolute -right-4 -bottom-4 text-emerald-50 opacity-50 transform rotate-12 group-hover:scale-110 transition-transform">
            <span class="material-symbols-rounded text-8xl">accessibility_new</span>
          </div>
        </div>

        <!-- Sitting -->
        <div
          class="bg-white rounded-2xl border border-slate-200 p-5 shadow-sm flex flex-col justify-between h-24 relative overflow-hidden group">
          <div class="flex items-center gap-2 z-10">
            <div class="w-8 h-8 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center">
              <span class="material-symbols-rounded">chair</span>
            </div>
            <span class="font-bold text-slate-500 text-sm">앉음</span>
          </div>
          <span id="count-sitting" class="text-3xl font-black text-blue-600 z-10 ml-1">0</span>
          <!-- Decoration -->
          <div
            class="absolute -right-4 -bottom-4 text-blue-50 opacity-50 transform rotate-12 group-hover:scale-110 transition-transform">
            <span class="material-symbols-rounded text-8xl">chair</span>
          </div>
        </div>

        <!-- Away -->
        <div
          class="bg-white rounded-2xl border border-slate-200 p-5 shadow-sm flex flex-col justify-between h-24 relative overflow-hidden group">
          <div class="flex items-center gap-2 z-10">
            <div class="w-8 h-8 rounded-lg bg-red-50 text-red-600 flex items-center justify-center">
              <span class="material-symbols-rounded">person_off</span>
            </div>
            <span class="font-bold text-slate-500 text-sm">자리비움</span>
          </div>
          <span id="count-away" class="text-3xl font-black text-red-600 z-10 ml-1">0</span>
          <!-- Decoration -->
          <div
            class="absolute -right-4 -bottom-4 text-red-50 opacity-50 transform rotate-12 group-hover:scale-110 transition-transform">
            <span class="material-symbols-rounded text-8xl">person_off</span>
          </div>
        </div>
      </div>

      <!-- 2. Learning Status (Main List) -->
      <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
        <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
          <div class="flex items-center gap-2">
            <span class="material-symbols-rounded text-emerald-600 text-xl">bar_chart</span>
            <h3 class="font-bold text-lg text-slate-800">학습 현황</h3>
          </div>
          <button id="broadcast-btn"
            class="hidden px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-600 text-xs font-bold rounded-lg transition-colors flex items-center gap-1.5">
            실시간
          </button>
        </div>

        <!-- Student List Container -->
        <div id="student-grid" class="p-6 space-y-4">
          <!-- Student Cards will be injected here as rows -->
          <div class="flex flex-col items-center justify-center py-12 text-center text-slate-400">
            <div class="w-16 h-16 mb-4 rounded-2xl bg-slate-50 flex items-center justify-center">
              <span class="material-symbols-rounded text-3xl opacity-30">hourglass_top</span>
            </div>
            <h4 class="text-base font-bold text-slate-500 mb-1">접속한 학생이 없습니다</h4>
            <p class="text-xs text-slate-400">학생이 입장하면 실시간으로 표시됩니다</p>
          </div>
        </div>
      </div>

      <!-- 3. Snapshot Section (Placeholder) -->
      <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden min-h-[200px]">
        <div class="px-6 py-4 border-b border-slate-100 flex items-center gap-2 bg-slate-50/50">
          <span class="material-symbols-rounded text-indigo-600 text-xl">photo_camera</span>
          <h3 class="font-bold text-lg text-slate-800">오늘의 학습 스냅샷</h3>
        </div>
        <div class="flex flex-col items-center justify-center py-12 text-center text-slate-400">
          <span class="material-symbols-rounded text-4xl mb-2 opacity-30">image_not_supported</span>
          <p class="text-sm">스냅샷을 불러오는 중...</p>
        </div>
      </div>

      <!-- 4. Reports Section -->
      <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
        <div class="px-6 py-4 border-b border-slate-100 flex items-center gap-2 bg-slate-50/50">
          <span class="material-symbols-rounded text-purple-600 text-xl">assessment</span>
          <h3 class="font-bold text-lg text-slate-800">리포트</h3>
        </div>
        <div class="p-6">
          <!-- Report Content Placeholder -->
          <div class="bg-slate-50 rounded-xl p-4 border border-slate-100 flex items-center gap-4">
            <div class="w-12 h-12 bg-white rounded-xl flex items-center justify-center shadow-sm text-purple-500">
              <span class="material-symbols-rounded">calendar_today</span>
            </div>
            <div>
              <h4 class="font-bold text-slate-800">1월 19일 (월)</h4>
              <p class="text-xs text-slate-500">2개 세션</p>
            </div>
            <button
              class="ml-auto px-4 py-2 bg-primary text-white font-bold rounded-xl text-sm shadow-sm hover:bg-red-700 transition-colors">
              검수중
            </button>
          </div>
          <!-- Timeline Chart Container -->
          <div class="mt-4 h-64 w-full bg-slate-50 rounded-xl border border-slate-100 flex items-center justify-center">
            <span class="text-xs font-mono text-slate-400 flex items-center gap-2">
              <span class="material-symbols-rounded text-sm">schedule</span>
              17:03:56 (Timeline Placeholder)
            </span>
          </div>
        </div>
      </div>
    </section>

    <!-- Alert List -->
    <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden flex flex-col h-[500px]">
      <div class="px-4 py-3 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
        <div class="flex items-center gap-2">
          <span class="material-symbols-rounded text-primary text-lg">notifications</span>
          <h3 class="font-bold text-sm text-slate-700">ALERTS</h3>
        </div>
      </div>
      <div id="alert-list" class="flex-1 overflow-y-auto p-3 space-y-2 bg-slate-50/30">
        <div class="flex flex-col items-center justify-center py-10 text-center text-slate-400">
          <div class="w-10 h-10 mb-3 rounded-full bg-slate-100 flex items-center justify-center">
            <span class="material-symbols-rounded text-lg opacity-50">notifications_off</span>
          </div>
          <h4 class="text-sm font-bold text-slate-500">알림이 없습니다</h4>
        </div>
      </div>
    </div>
    </div>
    </section>
  </main>

  <!-- Video Modal -->
  <div id="video-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/80 backdrop-blur-sm">
    <div class="bg-surface-light dark:bg-surface-dark rounded-2xl overflow-hidden shadow-2xl max-w-2xl w-full mx-4">
      <div class="px-6 py-4 bg-primary flex items-center justify-between">
        <h3 class="font-bold text-white flex items-center gap-2">
          <span class="material-symbols-rounded">videocam</span>
          <span id="modal-student-name">학생</span> 영상 확인
        </h3>
        <button id="close-modal-btn" class="p-2 hover:bg-white/20 rounded-lg transition-colors text-white">
          <span class="material-symbols-rounded">close</span>
        </button>
      </div>
      <div class="p-4 bg-black flex items-center justify-center">
        <video id="modal-video" autoplay playsinline class="rounded-lg w-[640px] h-[480px] object-contain"></video>
      </div>
    </div>
  </div>

  <!-- Focus Detail Modal -->
  <div id="focus-detail-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 overflow-y-auto">
    <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm"
      onclick="window.closeFocusModal && window.closeFocusModal()"></div>
    <div
      class="relative z-20 w-full max-w-xl my-4 bg-white rounded-2xl shadow-2xl overflow-hidden border border-slate-200 transition-all duration-300">
      <!-- Header -->
      <div class="bg-primary px-4 py-3 flex items-center justify-between sticky top-0 z-10 shadow-sm">
        <div class="flex items-center space-x-2">
          <div class="bg-white/20 p-1.5 rounded-lg backdrop-blur-sm">
            <span class="material-symbols-rounded text-white text-lg">analytics</span>
          </div>
          <h1 class="text-white text-base font-bold"><span id="focus-detail-name">학생</span> 집중도 분석</h1>
        </div>
        <button id="close-focus-detail-btn"
          class="text-white hover:bg-white/10 rounded-full p-1 transition-colors focus:outline-none">
          <span class="material-symbols-rounded text-xl">close</span>
        </button>
      </div>

      <!-- Content -->
      <div class="p-5 space-y-5 max-h-[70vh] overflow-y-auto">
        <!-- Current Score Display -->
        <div class="flex items-center justify-center gap-8 py-2">
          <div class="text-center">
            <p class="text-slate-500 text-xs font-bold mb-1 uppercase tracking-wide">Current Focus</p>
            <div id="focus-detail-score" class="text-5xl font-bold text-primary tracking-tight">-</div>
          </div>
          <div class="h-12 w-px bg-slate-200"></div>
          <div class="text-center">
            <p class="text-slate-500 text-xs font-bold mb-1 uppercase tracking-wide">Status</p>
            <div id="focus-detail-level"
              class="text-xl font-bold text-slate-800 flex items-center justify-center gap-1.5">
              <span>-</span>
              <span class="relative flex h-2.5 w-2.5">
                <span
                  class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary/50 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-primary"></span>
              </span>
            </div>
          </div>
        </div>

        <!-- Chart Section -->
        <div class="bg-slate-50 rounded-xl p-4 border border-slate-100">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-sm font-bold text-slate-800">집중도 추이</h3>
            <div class="flex items-center gap-1">
              <button onclick="window.setChartRange(60)"
                class="chart-range-btn px-2.5 py-1 text-xs rounded-md bg-white border border-slate-200 text-slate-600 font-medium hover:border-sidebar-accent hover:text-primary transition-all shadow-sm"
                data-range="60">1분</button>
              <button onclick="window.setChartRange(180)"
                class="chart-range-btn px-2.5 py-1 text-xs rounded-md bg-white border border-slate-200 text-slate-600 font-medium hover:border-sidebar-accent hover:text-primary transition-all shadow-sm"
                data-range="180">3분</button>
              <button onclick="window.setChartRange(300)"
                class="chart-range-btn px-2.5 py-1 text-xs rounded-md bg-white border border-slate-200 text-slate-600 font-medium hover:border-sidebar-accent hover:text-primary transition-all shadow-sm"
                data-range="300">5분</button>
            </div>
          </div>
          <div class="relative h-48 w-full">
            <canvas id="focus-chart"></canvas>
          </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-3 gap-3">
          <div class="bg-white border border-slate-100 shadow-sm rounded-xl p-3 text-center">
            <div class="inline-flex p-1.5 rounded-full bg-slate-100 text-slate-600 mb-1">
              <span class="material-symbols-rounded text-lg">trending_up</span>
            </div>
            <p class="text-[10px] text-slate-400 font-bold uppercase mt-1">Average</p>
            <p id="focus-avg-score" class="text-lg font-bold text-slate-900">-</p>
          </div>
          <div class="bg-white border border-slate-100 shadow-sm rounded-xl p-3 text-center">
            <div class="inline-flex p-1.5 rounded-full bg-red-50 text-red-500 mb-1">
              <span class="material-symbols-rounded text-lg">trending_down</span>
            </div>
            <p class="text-[10px] text-slate-400 font-bold uppercase mt-1">Min</p>
            <p id="focus-min-score" class="text-lg font-bold text-slate-900">-</p>
          </div>
          <div class="bg-white border border-slate-100 shadow-sm rounded-xl p-3 text-center">
            <div class="inline-flex p-1.5 rounded-full bg-slate-100 text-slate-600 mb-1">
              <span class="material-symbols-rounded text-lg">star</span>
            </div>
            <p class="text-[10px] text-slate-400 font-bold uppercase mt-1">Max</p>
            <p id="focus-max-score" class="text-lg font-bold text-slate-900">-</p>
          </div>
        </div>

        <!-- Analysis Info -->
        <div class="grid grid-cols-3 gap-3">
          <div class="bg-slate-50 rounded-xl p-3 text-center border border-slate-100">
            <span class="material-symbols-rounded text-slate-400 text-xl">visibility</span>
            <p class="text-xs text-slate-500 font-medium mt-1">시선 추적</p>
          </div>
          <div class="bg-slate-50 rounded-xl p-3 text-center border border-slate-100">
            <span class="material-symbols-rounded text-slate-400 text-xl">face</span>
            <p class="text-xs text-slate-500 font-medium mt-1">고개 위치</p>
          </div>
          <div class="bg-slate-50 rounded-xl p-3 text-center border border-slate-100">
            <span class="material-symbols-rounded text-slate-400 text-xl">person_search</span>
            <p class="text-xs text-slate-500 font-medium mt-1">존재 감지</p>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="px-5 py-3 text-center border-t border-slate-100 bg-slate-50">
        <p id="focus-last-update" class="text-[10px] text-slate-400 font-mono">Last updated: -</p>
      </div>
    </div>
  </div>

  <!-- Message Modal -->
  <div id="message-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm"></div>

    <!-- Modal Content -->
    <div
      class="relative z-20 w-full max-w-lg bg-white rounded-2xl shadow-2xl overflow-hidden transform transition-all duration-300 border border-slate-200">
      <!-- Header -->
      <div class="bg-slate-900 px-6 py-4 flex items-center justify-between shadow-sm">
        <div class="flex items-center space-x-3 text-white">
          <span class="material-symbols-rounded text-xl">campaign</span>
          <h2 id="message-modal-title" class="text-base font-bold tracking-wide">전체 공지</h2>
        </div>
        <button id="close-message-modal-btn"
          class="text-white/60 hover:text-white p-1 rounded-full transition-colors focus:outline-none">
          <span class="material-symbols-rounded text-xl">close</span>
        </button>
      </div>

      <!-- Body -->
      <div class="p-6 space-y-5">
        <div class="flex items-start space-x-3 text-slate-600">
          <span class="material-symbols-rounded text-primary mt-0.5 text-lg">info</span>
          <p id="message-target-info" class="text-sm font-medium leading-relaxed"></p>
        </div>

        <div class="relative group">
          <textarea id="message-input" rows="5"
            class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl text-slate-800 placeholder-slate-400 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all resize-none text-base leading-relaxed"
            placeholder="메시지를 입력하세요..."></textarea>
          <div class="absolute bottom-4 right-4 text-xs text-slate-400 pointer-events-none">Enter로 줄바꿈
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="px-6 py-4 bg-slate-50 border-t border-slate-100 flex gap-3">
        <button id="cancel-message-btn"
          class="flex-1 py-2.5 px-4 rounded-xl font-bold text-slate-600 bg-white border border-slate-200 hover:bg-slate-50 hover:text-slate-800 transition-all duration-200 focus:outline-none shadow-sm">
          취소
        </button>
        <button id="send-message-btn"
          class="flex-1 py-2.5 px-4 rounded-xl font-bold text-white bg-primary hover:bg-red-700 active:scale-[0.98] transition-all duration-200 shadow-sm shadow-red-500/20 focus:outline-none flex items-center justify-center space-x-2 group">
          <span
            class="material-symbols-rounded text-lg group-hover:-rotate-12 transition-transform duration-300">send</span>
          <span>전송</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Alert Sound - Preserved -->
  <audio id="alert-sound" preload="auto">
    <source
      src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2teleQYAQKPd7KlmBgBBqeHvqGQGAEKu5fKnYgYAQ7Pp9aZgBgBEuO34pV4GAEa98NqjXAYAR8Lz3aJaBgBIx/bgoFgGAEnM+eOeVgYASdH85JxUBgBK1v/nmVIGAEvb/+qXUAYATOD/7ZVOBgBN5f/wk0wGAE7q//OSSwYAT+///5FJBgBQ9P/+j0cGAFH5//6NRQYAUv7//4tDBgBT////iUEGAFT///+HPwYAVf///4U9BgBW////gzsGAFf///+BOQYAVv///4E3BgBV////gTUGAFT///+BMwYAU////4ExBgBS////gS8GAFH///+BLQYAUf///4ErBgBQ////gSkGAE////+BJwYATv///4ElBgBN////gSMGAEz///+BIQYASv///4EfBgBJ////gR0GAEj///+BGwYAR////4EZBgBG////gRcGAEX///+BFQYARf///4ETBgBE////gREGAEP///+BDwYAQv///4ENBgBB////gQsGAED///+BCQYAPv///4EHBgA9////gQUGADz///+BAwYAO////4EBBQA6////fwAFADn///99/wQAOP///3v+BAA3////ef0EADX///93/AQANP///3X7BAA0////c/oEADP///9x+QQAM////2/4BAAy////bfcEADH///9r9gQAMP///2n1BAA="
      type="audio/wav">
  </audio>

  <!-- Attendance Modal -->
  <div id="attendance-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 overflow-y-auto">
    <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm"
      onclick="window.closeAttendanceModal && window.closeAttendanceModal()"></div>
    <div
      class="relative z-20 w-full max-w-md my-4 bg-white rounded-2xl shadow-2xl overflow-hidden border border-slate-200">
      <!-- Header -->
      <div class="bg-white px-5 py-4 flex items-center justify-between border-b border-slate-100">
        <div class="flex items-center space-x-2">
          <div class="bg-slate-100 p-1.5 rounded-lg">
            <span class="material-symbols-rounded text-slate-600 text-lg">calendar_month</span>
          </div>
          <h1 class="text-slate-800 text-base font-bold"><span id="attendance-student-name">학생</span> 출석 현황</h1>
        </div>
        <button id="close-attendance-modal-btn" onclick="window.closeAttendanceModal && window.closeAttendanceModal()"
          class="text-slate-400 hover:bg-slate-100 rounded-full p-1 transition-colors">
          <span class="material-symbols-rounded text-xl">close</span>
        </button>
      </div>

      <!-- Content -->
      <div class="p-5 space-y-5">
        <!-- 주간/월간 통계 -->
        <div class="grid grid-cols-2 gap-3">
          <!-- 주간 -->
          <div class="bg-slate-50 rounded-xl p-3 border border-slate-200">
            <div class="flex items-center gap-2 mb-2">
              <span class="material-symbols-rounded text-slate-500 text-lg">date_range</span>
              <span class="font-bold text-sm text-slate-700">이번 주</span>
            </div>
            <div class="space-y-1.5">
              <div class="flex justify-between items-center">
                <span class="text-xs text-slate-500">출석일</span>
                <span id="attendance-weekly-days" class="font-bold text-sm text-slate-800">0/0일</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-xs text-slate-500">출석률</span>
                <span id="attendance-weekly-rate" class="font-bold text-sm text-slate-800">0%</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-xs text-slate-500">총 시간</span>
                <span id="attendance-weekly-time" class="font-bold text-sm text-slate-800">0분</span>
              </div>
            </div>
          </div>

          <!-- 월간 -->
          <div class="bg-slate-50 rounded-xl p-3 border border-slate-200">
            <div class="flex items-center gap-2 mb-2">
              <span class="material-symbols-rounded text-slate-500 text-lg">calendar_month</span>
              <span class="font-bold text-sm text-slate-700">이번 달</span>
            </div>
            <div class="space-y-1.5">
              <div class="flex justify-between items-center">
                <span class="text-xs text-slate-500">출석일</span>
                <span id="attendance-monthly-days" class="font-bold text-sm text-slate-800">0/0일</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-xs text-slate-500">출석률</span>
                <span id="attendance-monthly-rate" class="font-bold text-sm text-slate-800">0%</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-xs text-slate-500">총 시간</span>
                <span id="attendance-monthly-time" class="font-bold text-sm text-slate-800">0분</span>
              </div>
            </div>
          </div>
        </div>

        <!-- 캘린더 -->
        <div class="bg-white rounded-xl p-3 border border-slate-200">
          <div id="attendance-calendar">
            <!-- 캘린더가 여기에 렌더링됨 -->
          </div>
          <div class="flex items-center justify-center gap-4 mt-3 pt-2 border-t border-slate-100">
            <div class="flex items-center gap-1.5">
              <div class="w-3 h-3 rounded bg-slate-200 border border-slate-300">
              </div>
              <span class="text-[10px] text-slate-500">출석</span>
            </div>
            <div class="flex items-center gap-1.5">
              <div class="w-3 h-3 rounded bg-slate-100 border border-slate-300">
              </div>
              <span class="text-[10px] text-slate-500">결석</span>
            </div>
            <div class="flex items-center gap-1.5">
              <div class="w-3 h-3 rounded ring-2 ring-primary"></div>
              <span class="text-[10px] text-slate-500">오늘</span>
            </div>
          </div>
        </div>

        <!-- 다운로드 버튼 -->
        <div class="flex gap-2">
          <button onclick="window.downloadAttendanceCSV && window.downloadAttendanceCSV()"
            class="flex-1 py-2.5 px-4 bg-white border border-slate-200 hover:bg-slate-50 text-slate-700 font-bold rounded-lg transition-all flex items-center justify-center gap-2 text-sm shadow-sm">
            <span class="material-symbols-rounded text-lg">table_chart</span>
            CSV
          </button>
          <button onclick="window.downloadAttendancePDF && window.downloadAttendancePDF()"
            class="flex-1 py-2.5 px-4 bg-slate-900 hover:bg-slate-800 text-white font-bold rounded-lg transition-all flex items-center justify-center gap-2 text-sm shadow-sm">
            <span class="material-symbols-rounded text-lg">picture_as_pdf</span>
            PDF
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Focus Report Modal -->
  <div id="focus-report-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 overflow-y-auto">
    <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm"
      onclick="window.closeFocusReportModal && window.closeFocusReportModal()"></div>
    <div
      class="relative z-20 w-full max-w-md my-4 bg-white rounded-2xl shadow-2xl overflow-hidden border border-slate-200">
      <!-- Header -->
      <div class="bg-white px-5 py-4 flex items-center justify-between border-b border-slate-100">
        <div class="flex items-center space-x-2">
          <div class="bg-slate-100 p-1.5 rounded-lg">
            <span class="material-symbols-rounded text-slate-600 text-lg">assessment</span>
          </div>
          <div>
            <h1 class="text-slate-800 text-base font-bold"><span id="focus-report-student-name">학생</span> 집중도 보고서</h1>
            <span id="focus-report-student-grade" class="text-slate-500 text-xs"></span>
          </div>
        </div>
        <button id="close-focus-report-modal-btn"
          onclick="window.closeFocusReportModal && window.closeFocusReportModal()"
          class="text-slate-400 hover:bg-slate-100 rounded-full p-1 transition-colors">
          <span class="material-symbols-rounded text-xl">close</span>
        </button>
      </div>

      <!-- Period Selector -->
      <div class="px-5 py-3 bg-slate-50 border-b border-slate-100">
        <div class="flex items-center justify-center gap-2">
          <button onclick="window.setFocusReportType('daily')" data-type="daily"
            class="focus-report-type-btn px-3 py-1.5 text-xs rounded-lg bg-primary text-white font-bold transition-all shadow-sm">
            일간
          </button>
          <button onclick="window.setFocusReportType('weekly')" data-type="weekly"
            class="focus-report-type-btn px-3 py-1.5 text-xs rounded-lg bg-white border border-slate-200 text-slate-600 font-medium transition-all hover:bg-slate-100">
            주간
          </button>
          <button onclick="window.setFocusReportType('monthly')" data-type="monthly"
            class="focus-report-type-btn px-3 py-1.5 text-xs rounded-lg bg-white border border-slate-200 text-slate-600 font-medium transition-all hover:bg-slate-100">
            월간
          </button>
        </div>
      </div>

      <!-- Content -->
      <div id="focus-report-content" class="p-5">
        <!-- 보고서 내용이 여기에 렌더링됨 -->
      </div>

      <!-- Download Buttons -->
      <div class="px-5 pb-5">
        <div class="flex gap-2">
          <button onclick="window.downloadFocusReportCSV && window.downloadFocusReportCSV()"
            class="flex-1 py-2.5 px-4 bg-white border border-slate-200 hover:bg-slate-50 text-slate-700 font-bold rounded-lg transition-all flex items-center justify-center gap-2 text-sm shadow-sm">
            <span class="material-symbols-rounded text-lg">table_chart</span>
            CSV
          </button>
          <button onclick="window.downloadFocusReportPDF && window.downloadFocusReportPDF()"
            class="flex-1 py-2.5 px-4 bg-slate-900 hover:bg-slate-800 text-white font-bold rounded-lg transition-all flex items-center justify-center gap-2 text-sm shadow-sm">
            <span class="material-symbols-rounded text-lg">picture_as_pdf</span>
            PDF
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Today Attendance List Modal -->
  <div id="today-attendance-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 overflow-y-auto">
    <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm"
      onclick="window.closeTodayAttendanceModal && window.closeTodayAttendanceModal()"></div>
    <div
      class="relative z-20 w-full max-w-md my-4 bg-white rounded-2xl shadow-2xl overflow-hidden border border-slate-200">
      <!-- Header -->
      <div class="bg-white px-5 py-4 flex items-center justify-between border-b border-slate-100">
        <div class="flex items-center space-x-2">
          <div class="bg-slate-100 p-1.5 rounded-lg">
            <span class="material-symbols-rounded text-slate-600 text-lg">event_available</span>
          </div>
          <div>
            <h1 class="text-slate-800 text-base font-bold">오늘 출석자 명단</h1>
            <span id="today-attendance-date" class="text-slate-500 text-xs"></span>
          </div>
        </div>
        <button onclick="window.closeTodayAttendanceModal && window.closeTodayAttendanceModal()"
          class="text-slate-400 hover:bg-slate-100 rounded-full p-1 transition-colors">
          <span class="material-symbols-rounded text-xl">close</span>
        </button>
      </div>

      <!-- Summary -->
      <div class="px-5 py-3 bg-slate-50 border-b border-slate-200">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-2">
            <span class="material-symbols-rounded text-slate-900">groups</span>
            <span class="text-sm font-bold text-slate-700">총 출석</span>
          </div>
          <span id="today-attendance-total" class="text-xl font-bold text-slate-900">0명</span>
        </div>
      </div>

      <!-- Student List -->
      <div id="today-attendance-list" class="p-5 max-h-[50vh] overflow-y-auto">
        <!-- 출석자 목록이 여기에 렌더링됨 -->
        <div class="flex flex-col items-center justify-center py-8 text-slate-400">
          <span class="material-symbols-rounded text-3xl mb-2 opacity-50">person_off</span>
          <p class="text-sm font-medium">아직 출석한 학생이 없습니다</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Class Settings Modal -->
  <div id="class-settings-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
    <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm"
      onclick="window.closeClassSettings && window.closeClassSettings()"></div>
    <div class="relative z-20 w-full max-w-sm bg-white rounded-2xl shadow-2xl overflow-hidden border border-slate-200">
      <!-- Header -->
      <div class="bg-white px-5 py-4 flex items-center justify-between border-b border-slate-100">
        <div class="flex items-center space-x-2">
          <div class="bg-slate-100 p-1.5 rounded-lg">
            <span class="material-symbols-rounded text-slate-600 text-lg">schedule</span>
          </div>
          <h1 class="text-slate-800 text-base font-bold">수업 시간 설정</h1>
        </div>
        <button onclick="window.closeClassSettings && window.closeClassSettings()"
          class="text-slate-400 hover:bg-slate-100 rounded-full p-1 transition-colors">
          <span class="material-symbols-rounded text-xl">close</span>
        </button>
      </div>

      <!-- Content -->
      <div class="p-6 space-y-5">
        <div>
          <label class="block text-sm font-bold text-slate-700 mb-2">
            <span class="flex items-center gap-2">
              <span class="material-symbols-rounded text-primary text-lg">school</span>
              수업 시간
            </span>
          </label>
          <div class="flex items-center gap-2">
            <input type="number" id="lesson-duration-input" min="1" max="180" value="50"
              class="flex-1 px-3 py-2.5 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 text-center font-bold text-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
            <span class="text-slate-500 font-medium">분</span>
          </div>
          <p class="text-xs text-slate-400 mt-1.5 ml-1">1~180분 사이로 설정</p>
        </div>

        <div>
          <label class="block text-sm font-bold text-slate-700 mb-2">
            <span class="flex items-center gap-2">
              <span class="material-symbols-rounded text-slate-500 text-lg">coffee</span>
              쉬는 시간
            </span>
          </label>
          <div class="flex items-center gap-2">
            <input type="number" id="break-duration-input" min="1" max="60" value="10"
              class="flex-1 px-3 py-2.5 rounded-xl border border-slate-200 bg-slate-50 text-slate-900 text-center font-bold text-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all">
            <span class="text-slate-500 font-medium">분</span>
          </div>
          <p class="text-xs text-slate-400 mt-1.5 ml-1">1~60분 사이로 설정</p>
        </div>

        <div class="bg-slate-50 rounded-xl p-3 border border-slate-200">
          <div class="flex items-start gap-2">
            <span class="material-symbols-rounded text-slate-500 text-lg mt-0.5">info</span>
            <div class="text-xs text-slate-700">
              <p class="font-bold mb-1">쉬는 시간 동안:</p>
              <ul class="list-disc list-inside space-y-0.5 text-slate-600">
                <li>자리비움 알림이 비활성화됩니다</li>
                <li>집중도 데이터가 통계에서 제외됩니다</li>
                <li>학생들에게 쉬는 시간 알림이 전송됩니다</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="px-6 pb-6">
        <button id="save-class-settings-btn" onclick="window.saveClassSettings && window.saveClassSettings()"
          class="w-full py-3 px-4 bg-primary hover:bg-red-700 text-white font-bold rounded-xl transition-all flex items-center justify-center gap-2 shadow-sm shadow-red-500/20">
          <span class="material-symbols-rounded text-lg">save</span>
          저장
        </button>
      </div>
    </div>
  </div>


  <!-- Response List -->
  <div>
    <h4 class="text-sm font-bold text-slate-700 mb-3">응답 현황</h4>
    <div id="understanding-response-list" class="max-h-40 overflow-y-auto space-y-2 pr-1">
      <!-- 응답 목록이 여기에 표시됨 -->
    </div>
  </div>
  </div>

  <!-- Footer -->
  <div class="px-6 pb-6">
    <button onclick="window.closeUnderstandingResultModal && window.closeUnderstandingResultModal()"
      class="w-full py-3 px-4 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition-all">
      닫기
    </button>
  </div>
  </div>
  </div>

  <script type="module" src="js/teacher-app.js"></script>
</body>

</html>