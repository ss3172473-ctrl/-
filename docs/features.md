# 기능 명세서

## 개요

학생 모니터링 시스템은 AI 기반 실시간 자세 분석을 통해 교사가 학생들의 학습 상태를 모니터링할 수 있는 웹 애플리케이션입니다.

---

## 학생 기능

### 1. 자세 분석
- MediaPipe Pose를 활용한 실시간 자세 감지
- 상태: 서있음, 앉아있음, 자리비움, 손들기

### 2. 집중도 분석
- 고개 위치, 시선 방향, 존재 여부 기반 점수 산출
- 0~100점 실시간 표시

### 3. 교사 연결
- PeerJS P2P 연결
- 자동 재연결 (연결 끊김 시 5초마다 재시도)

### 4. 메시지
- 교사에게 메시지 전송
- 교사 메시지 수신 및 알림

### 5. 화면 공유
- 자동 화면 캡처 (썸네일)
- 교사에게 화면 상태 전송

### 6. 수업 모드 표시
- 수업 중 / 쉬는 시간 인디케이터
- 남은 시간 실시간 표시

---

## 교사 기능

### 1. 서버 관리
- 고정 ID 또는 자동 생성 ID
- ID 히스토리 저장 (최대 5개)

### 2. 학생 모니터링
- 실시간 학생 카드 그리드
- 상태별 색상 표시
- 집중도 점수 및 레벨

### 3. 통계 대시보드
- 총 학생 수
- 상태별 인원 (서있음/앉아있음/자리비움/손들기)

### 4. 알림 시스템
- 자리비움 경고 (1분)
- 자리비움 심각 (3분)
- 알림음 재생

### 5. 영상 확인
- 개별 학생 실시간 영상 보기
- 화면 썸네일 확인

### 6. 메시지
- 개별 학생에게 메시지 전송
- 전체 공지 (브로드캐스트)
- 학생 메시지 수신

### 7. PTT (Push-To-Talk)
- 개별 학생에게 음성 전송
- 마이크 버튼 누르는 동안 전송

### 8. 수업 타이머
- 수업 시간 / 쉬는 시간 설정
- 자동 전환
- 학생에게 모드 변경 알림

### 9. 출석 관리
- 자동 출석 체크 (접속 시)
- 일별/주간/월간 출석 현황
- 출석 캘린더
- CSV/PDF 다운로드

### 10. 집중도 보고서
- 일간/주간/월간 보고서
- 집중률, 평균 점수, 순 집중시간
- 지난달 대비 변화량 (월간)
- CSV/PDF 다운로드

### 11. 이해도 체크
- 질문 전송 (O/X, 1~5점)
- 실시간 응답 집계
- 결과 통계

---

## 기술적 특징

### P2P 통신
- 서버 없이 브라우저 간 직접 통신
- PeerJS 공식 서버 사용 (무료)
- 영상은 요청 시에만 전송 (대역폭 절약)

### 분산 처리
- 각 학생 PC에서 자체 AI 분석
- 교사에게는 결과 데이터만 전송

### 데이터 저장
- localStorage 기반 (서버 불필요)
- 출석/집중도 데이터 로컬 저장

---

## 상태 정의

| 상태 | 코드 | 설명 |
|------|------|------|
| 서있음 | `standing` | 상체-하체 비율 < 0.4 |
| 앉아있음 | `sitting` | 상체-하체 비율 > 0.6 |
| 자리비움 | `away` | 10프레임 이상 미감지 |
| 손들기 | `hand_raised` | 손이 어깨 위로 올라감 |
| 감지중 | `unknown` | 초기 상태 |
| 응답없음 | `no_response` | 10초 이상 데이터 없음 |
| 연결끊김 | `disconnected` | P2P 연결 해제 |
